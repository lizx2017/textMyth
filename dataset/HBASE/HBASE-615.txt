Summary:
Region balancer oscillates during cluster startup
Description:
When starting a cluster with four region servers and a large table (49 regions) (+root +meta) = 51 total regions, the region balancer oscillates for a very long time and does not seem to reach a steady state.
Additionally, for whatever reason, it seems reluctant to assign regions to the first of four region servers, which may be the root cause. In my test, the first server had 10 regions assigned, the second and fourth had 13 regions assigned, and the master would continually assign and deassign 2 regions to the third server, which oscillated between 13 and 15 regions. If it assigned the two fluctuating regions to the first server, it would achieve the best balance possible: 12, 13, 13, 13.
After 20 minutes, it had not stopped oscillating. An application trying to work against this cluster would run very slowly as it would be continually re-finding the two regions in flux.
When the table was being created, regions were nicely balanced. On restart, however, it just would not settle down.
Perhaps the balancer should set a target number of regions for each server which when the server achieved +/- 1 regions, the rebalancer would not try to change unless the number of regions changed.
Status:
CLOSED
Priority:
Blocker
Resolution:
Fixed
Affects_version:
0.2.0
Fix_version:
0.2.0
Component:
master
Label:
None
Environment:

Attachment number:
0
Assignee:
Bryan Duxbury
Reporter:
Jim Kellerman
Create date:
06/May/08 01:33
Update date:
22/Aug/08 21:13
Resolved date:
19/Jun/08 16:30
