Summary:
Scanner doesnt reset when a snapshot is created, could miss new updates into the 'kvset' (active part)
Description:
when a Scanner is created, it creates 2 MemStoreScanners on the kvset and the snapshot (internal names of Memstore)... if the snapshot is originally empty, it only creates the 1, for kvset. When the snapshot is created, the outstanding Scanners now have a pointer to the tree that is now the snapshot, but no pointer to the kvset.
When the flush completes, the scanner will reset the memstore scanners and 'see' the new values again.
If there is a large delay between snapshot and finalization of the flush, there can be a large period of time a scanner doesnt see 'new' values that are being inserted. the canonical 'bad' case where this can do things is the META scanner, and we end up with double assignment.
The snapshot is really lightweight, it only takes out a small lock in memstore, so im not sure there is an easy mechanism to hook to without building out a bit more code or restructuring the memstore scanner.
Status:
CLOSED
Priority:
Major
Resolution:
Fixed
Affects_version:
0.20.0
Fix_version:
0.20.0
Component:
None
Label:
None
Environment:

Attachment number:
0
Assignee:
stack
Reporter:
ryan rawson
Create date:
03/Aug/09 23:15
Update date:
13/Sep/09 22:24
Resolved date:
17/Aug/09 22:22
