Summary:
Invalid tracing info for execute_prepared_cql3_query
Description:
When using trace_next_query() then execute_prepared_cql3_query(), it looks like tracing info are invalid (number of sessions/events and columns values are wrong).
How to reproduce:
create keyspace Tests with replication = {'class': 'SimpleStrategy', 'replication_factor' : 1}
create table Tests.stresstest (strid varchar,intid int, primary key (strid))
and then executing the following prepared query 50,000 times:
insert into Tests.stresstest (intid, strid) values (?, ?)
produces the following results:
localhost> select count(*) from Tests.stresstest
+------------+
| count      |
+============+
| 50000      |
+------------+
localhost> select count(*) from system_traces.events
+------------+
| count      |
+============+
| 20832      |
+------------+
localhost> select count(*) from system_traces.sessions
+------------+
| count      |
+============+
| 26717      |
+------------+
localhost> select * from system_traces.sessions limit 10
+------------------------------------------+-----------------+--------------+----------------+---------------------------------+---------------------------+
| sessionid                                | coordinator     | duration     | parameters     | request                         | startedat                 |
+==========================================+=================+==============+================+=================================+===========================+
| 9aefc263-bcdb-11e2-8c60-fb495ee6a12c     | 127.0.0.1       |              |                | execute_prepared_cql3_query     | 5/14/2013 9:16:55 PM      |
+------------------------------------------+-----------------+--------------+----------------+---------------------------------+---------------------------+
| 9ce0bcf7-bcdb-11e2-8c60-fb495ee6a12c     | 127.0.0.1       |              |                | execute_prepared_cql3_query     | 5/14/2013 9:16:59 PM      |
+------------------------------------------+-----------------+--------------+----------------+---------------------------------+---------------------------+
| 9dbe4ba4-bcdb-11e2-8c60-fb495ee6a12c     | 127.0.0.1       |              |                | execute_prepared_cql3_query     | 5/14/2013 9:17:00 PM      |
+------------------------------------------+-----------------+--------------+----------------+---------------------------------+---------------------------+
| 9d4d3a54-bcdb-11e2-8c60-fb495ee6a12c     |                 | 44           |                |                                 |                           |
+------------------------------------------+-----------------+--------------+----------------+---------------------------------+---------------------------+
| 9a790bc1-bcdb-11e2-8c60-fb495ee6a12c     | 127.0.0.1       |              |                | execute_prepared_cql3_query     | 5/14/2013 9:16:55 PM      |
+------------------------------------------+-----------------+--------------+----------------+---------------------------------+---------------------------+
| 9c992c98-bcdb-11e2-8c60-fb495ee6a12c     | 127.0.0.1       |              |                | execute_prepared_cql3_query     | 5/14/2013 9:16:58 PM      |
+------------------------------------------+-----------------+--------------+----------------+---------------------------------+---------------------------+
| 9e27e2f6-bcdb-11e2-8c60-fb495ee6a12c     | 127.0.0.1       | 53           |                | execute_prepared_cql3_query     | 5/14/2013 9:17:01 PM      |
+------------------------------------------+-----------------+--------------+----------------+---------------------------------+---------------------------+
| 9b172074-bcdb-11e2-8c60-fb495ee6a12c     | 127.0.0.1       |              |                | execute_prepared_cql3_query     | 5/14/2013 9:16:56 PM      |
+------------------------------------------+-----------------+--------------+----------------+---------------------------------+---------------------------+
| 9a7cdc53-bcdb-11e2-8c60-fb495ee6a12c     | 127.0.0.1       | 53           |                | execute_prepared_cql3_query     | 5/14/2013 9:16:55 PM      |
+------------------------------------------+-----------------+--------------+----------------+---------------------------------+---------------------------+
| 9b6eb654-bcdb-11e2-8c60-fb495ee6a12c     | 127.0.0.1       |              |                | execute_prepared_cql3_query     | 5/14/2013 9:16:56 PM      |
+------------------------------------------+-----------------+--------------+----------------+---------------------------------+---------------------------+
Using binary protocol and enabling tracing produces expected results:
localhost> select count(*) from Tests.stresstest
+------------+
| count      |
+============+
| 50000      |
+------------+
localhost> select count(*) from system_traces.events
+-------------+
| count       |
+=============+
| 200002      |
+-------------+
localhost> select count(*) from system_traces.sessions
+------------+
| count      |
+============+
| 50001      |
+------------+
localhost> select * from system_traces.sessions limit 10
+------------------------------------------+-----------------+--------------+----------------+---------------------------------+---------------------------+
| sessionid                                | coordinator     | duration     | parameters     | request                         | startedat                 |
+==========================================+=================+==============+================+=================================+===========================+
| 745f5d10-bcdc-11e2-8c60-fb495ee6a12c     | 127.0.0.1       | 141          |                | Execute CQL3 prepared query     | 5/14/2013 9:23:00 PM      |
+------------------------------------------+-----------------+--------------+----------------+---------------------------------+---------------------------+
| 7ad9b050-bcdc-11e2-8c60-fb495ee6a12c     | 127.0.0.1       | 131          |                | Execute CQL3 prepared query     | 5/14/2013 9:23:11 PM      |
+------------------------------------------+-----------------+--------------+----------------+---------------------------------+---------------------------+
| 7ba00d90-bcdc-11e2-8c60-fb495ee6a12c     | 127.0.0.1       | 123          |                | Execute CQL3 prepared query     | 5/14/2013 9:23:12 PM      |
+------------------------------------------+-----------------+--------------+----------------+---------------------------------+---------------------------+
| 6ba0e635-bcdc-11e2-8c60-fb495ee6a12c     | 127.0.0.1       | 60           |                | Execute CQL3 prepared query     | 5/14/2013 9:22:45 PM      |
+------------------------------------------+-----------------+--------------+----------------+---------------------------------+---------------------------+
| 7f4595f0-bcdc-11e2-8c60-fb495ee6a12c     | 127.0.0.1       | 254          |                | Execute CQL3 prepared query     | 5/14/2013 9:23:18 PM      |
+------------------------------------------+-----------------+--------------+----------------+---------------------------------+---------------------------+
| 88c82020-bcdc-11e2-8c60-fb495ee6a12c     | 127.0.0.1       | 1138         |                | Execute CQL3 prepared query     | 5/14/2013 9:23:34 PM      |
+------------------------------------------+-----------------+--------------+----------------+---------------------------------+---------------------------+
| 83c6ff60-bcdc-11e2-8c60-fb495ee6a12c     | 127.0.0.1       | 142          |                | Execute CQL3 prepared query     | 5/14/2013 9:23:26 PM      |
+------------------------------------------+-----------------+--------------+----------------+---------------------------------+---------------------------+
| 824e1b05-bcdc-11e2-8c60-fb495ee6a12c     | 127.0.0.1       | 75           |                | Execute CQL3 prepared query     | 5/14/2013 9:23:23 PM      |
+------------------------------------------+-----------------+--------------+----------------+---------------------------------+---------------------------+
| 73957d60-bcdc-11e2-8c60-fb495ee6a12c     | 127.0.0.1       | 147          |                | Execute CQL3 prepared query     | 5/14/2013 9:22:59 PM      |
+------------------------------------------+-----------------+--------------+----------------+---------------------------------+---------------------------+
| 79f25d90-bcdc-11e2-8c60-fb495ee6a12c     | 127.0.0.1       | 153          |                | Execute CQL3 prepared query     | 5/14/2013 9:23:09 PM      |
+------------------------------------------+-----------------+--------------+----------------+---------------------------------+---------------------------+
Status:
RESOLVED
Priority:
Low
Resolution:
Not A Problem
Affects_version:

Fix_version:
None
Component:
None
Label:
qa-resolved
Environment:
windows 8
Attachment number:
0
Assignee:
Ryan McGuire
Reporter:
Pierre Chalamet
Create date:
14/May/13 21:43
Update date:
16/Apr/19 09:32
Resolved date:
19/Jun/13 21:49
